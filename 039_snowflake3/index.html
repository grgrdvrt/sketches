<html>
    <head>
        <title>Snowflake 3</title>
        <link rel="stylesheet" type="text/css" href="../css/styles.css"/>
    </head>
    <body>
        <script type="text/javascript" src="../libs/tools.js"></script>
        <script type="text/javascript">
         var slices = 2 * (3 + Math.round(Math.random() * 7));
         var angle = 2 * Math.PI / slices;
         var stage = new tools.Stage(700, 700);
         var tmp = document.createElement("canvas").getContext("2d");
         var w = tmp.canvas.width = 0.45 * stage.width;
         var h = tmp.canvas.height = w * Math.tan(0.5 * angle);

         var max = 200;
         var v = 5;
         var fr = 0.9;

         var i;


         tmp.strokeStyle = "black";
         tmp.fillStyle = "back";

         var ran = Math.random;
         var hue = ran() * 360;
         var s = ran() * 0.5;
         var l = ran() * ran() * 0.1;
         for(var j = 0; j < 50; j++){

             var x = ran() * w, y = ran() * h;
             var vx = 0, vy = 0;
             var h2 = (ran() < 0.05 ? 180 : 0) + hue + (ran() * 2- 1) * 20;
             var s2 = ran();
             var l2 = l + ran() * 0.9;
             tmp.fillStyle = "hsl(" + Math.floor(h2) + "," + Math.floor(s2 * 100) + "%," + Math.floor(l2 * 100) + "%)";
             tmp.beginPath();
             var n = Math.pow(Math.random(), 5) * max;
             for(i = 0; i < n; i++){
                 vx = fr * vx + v * (Math.random() * 2 - 1);
                 vy = fr * vy + v * (Math.random() * 2 - 1);
                 x += vx;
                 y += vy;
                 if(x < 0){
                     x = 0;
                     vx *= -1;
                 }
                 else if(x > w){
                     x = w;
                     vx *= -1;
                 }
                 if(y < 0){
                     y = 0;
                     vy *= -1;
                 }
                 else if(y > x * h / w){
                     y = x * h / w;
                     vy *= -1;
                 }
                 tmp.lineTo(x, y);
             }
             tmp.fill();
         }

         var out = stage.out;

         out.translate(0.5 * stage.width, 0.5 * stage.height);
         for(i = 0; i < slices; i++){
             out.save();
             out.rotate(i * angle);
             out.drawImage(tmp.canvas, 0, 0);
             out.restore();
             out.save();
             out.scale(1, -1);
             out.rotate(i * angle);
             out.drawImage(tmp.canvas, 0, 0);
             out.restore();
         }
        </script>
    </body>
</html>
