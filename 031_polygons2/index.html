<html>
    <head>
        <title>polygons 2</title>
        <link rel="stylesheet" type="text/css" href="../css/styles.css"/>
    </head>
    <body>
        <script type="text/javascript" src="../libs/tools.js"></script>
        <script type="text/javascript">
         var stage = new tools.Stage(700, 700);

         var pts = [];
         var n = 3;
         var fr = 0.9;
         var v = 2;

         var radius = 0.25 * Math.sqrt(stage.width * stage.width + stage.height * stage.height);
         var radius2 = radius * radius;
         var center = new Point(0.5 * stage.width, 0.5 * stage.height);

         stage.out.strokeStyle = "black";

         for(var i = 0; i < n; i++){
             var pt = new Point(center.x + Math.random() * radius, center.y + Math.random() * radius);
             pt.vx = v * (Math.random() * 2 - 1);
             pt.vy = v * (Math.random() * 2 - 1);
             pts[i] = pt;
         }

         var out = stage.out;
         function update(){
             out.clearRect(0, 0, stage.width, stage.height);
             out.beginPath();
             out.arc(center.x, center.y, radius, 0, 2 * Math.PI);
             var pt = pts[0];
             var i;
             for(i = 0; i < n; i++){
                 pt = pts[i];
                 pt.x += pt.vx;
                 pt.y += pt.vy;
                 var dx = pt.x - center.x;
                 var dy = pt.y - center.y;
                 var d = dx * dx + dy * dy;
                 if(d > radius2){
                     var a = -2 * Math.atan2(dy, dx);
                     var exp1 = Math.cos(a);
                     var exp2 = Math.sin(a);
                     var tx = -exp1 * pt.vx + exp2 * pt.vy;
                     pt.vy = exp2 * pt.vx + exp1 * pt.vy;
                     pt.vx = tx;

                     var r = radius / Math.sqrt(d);
                     pt.x = center.x + r * dx;
                     pt.y = center.y + r * dy;
                 }
             }

             pt = pts[n - 1];
             out.moveTo(pt.x, pt.y);
             for(var i = 0; i < n; i++){
                 pt = pts[i];
                 out.lineTo(pt.x, pt.y);
             }
             out.stroke();
             out.closePath();
         }

         function Point(x, y){
             this.x = x;
             this.y = y;
             this.vx = this.vy = 0;
         }

         new tools.Loop(update, this);
        </script>
    </body>
</html>
